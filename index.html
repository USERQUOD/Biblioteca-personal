<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>High School Salty Heart - Biblioteca</title>
    <style>
        body { background: #121212; color: white; font-family: sans-serif; margin: 0; text-align: center; overflow-x: hidden; }
        
        /* FONDO BORROSO */
        .fondo-borroso {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: url('portada.jpg') no-repeat center center;
            background-size: cover;
            filter: blur(25px) brightness(0.3);
            transform: scale(1.1);
            z-index: -1;
        }

        .contenedor { padding: 40px 20px; max-width: 600px; margin: auto; position: relative; }
        
        img.portada { 
            width: 100%; max-width: 280px; border-radius: 10px; margin-bottom: 20px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.8); border: 1px solid rgba(255,255,255,0.1);
        }

        .sinopsis { 
            background: rgba(20, 20, 20, 0.85); padding: 20px; border-radius: 10px; 
            text-align: left; margin-bottom: 25px; font-size: 14px; line-height: 1.5; 
            backdrop-filter: blur(10px); border-left: 4px solid #e50914;
        }
        
        /* GRID DE BOTONES AUTOMÁTICOS */
        .grid-capitulos { display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 12px; }
        
        .btn-cap { 
            background: #e50914; color: white; border: none; padding: 15px; 
            cursor: pointer; border-radius: 5px; font-weight: bold; 
            display: none; /* Se activa solo si existe la carpeta */
            transition: 0.3s;
        }
        .btn-cap:hover { transform: scale(1.05); background: #ff0000; }
        
        /* LECTOR LIMPIO (SIN NADA ARRIBA) */
        #visor-manga { display: none; background: black; width: 100%; position: absolute; top: 0; left: 0; z-index: 100; }
        #visor-manga img { width: 100%; max-width: 800px; display: block; margin: 0 auto; }
        
        /* NAVEGACIÓN SOLO ABAJO */
        .controles-inferiores { padding: 50px 20px; background: #121212; display: flex; flex-direction: column; align-items: center; gap: 15px; }
        .btn-nav { background: #e50914; color: white; border: none; padding: 18px 30px; font-size: 16px; font-weight: bold; border-radius: 8px; cursor: pointer; width: 100%; max-width: 350px; }
        .btn-secundario { background: #333; color: white; border: none; padding: 12px 20px; border-radius: 5px; cursor: pointer; }
    </style>
</head>
<body>

    <div class="fondo-borroso"></div>

    <div id="inicio" class="contenedor">
        <h1>High School Salty Heart</h1>
        <img src="portada.jpg" class="portada">
        
        <div class="sinopsis">
            <strong>Sinopsis:</strong><br>
            Cha Geonwu creyó haber dejado atrás su amor imposible por Lee Taejun, pero, después de regresar a la universidad, el destino lo empuja de nuevo hacia él.
        </div>

        <h3 style="text-align: left;">Capítulos Publicados:</h3>
        <div class="grid-capitulos" id="lista-botones"></div>
    </div>

    <div id="visor-manga">
        <div id="lista-imagenes"></div>

        <div class="controles-inferiores">
            <p style="color: #666; margin-bottom: 10px;">Fin del capítulo</p>
            <button id="btn-sig" class="btn-nav">SIGUIENTE CAPÍTULO ➡️</button>
            <button class="btn-secundario" onclick="location.reload()">VER LISTA DE CAPÍTULOS</button>
            <button id="btn-ant" class="btn-secundario">⬅️ CAPÍTULO ANTERIOR</button>
        </div>
    </div>

    <script>
        const contenedorBotones = document.getElementById('lista-botones');
        
        // FUNCIÓN DE DETECCIÓN AUTOMÁTICA MEJORADA
        function detectarCapitulos() {
            for (let i = 1; i <= 500; i++) {
                const boton = document.createElement('button');
                boton.className = 'btn-cap';
                boton.id = 'btn-cap-' + i;
                boton.innerText = 'Cap ' + i;
                boton.onclick = () => abrirCapitulo(i);
                contenedorBotones.appendChild(boton);

                // Forzamos la búsqueda de la imagen 1.jpg en cada carpeta
                let imgCheck = new Image();
                // Añadimos un parámetro de tiempo para evitar la caché de GitHub
                imgCheck.src = "cap-" + i + "/1.jpg?t=" + new Date().getTime();

                imgCheck.onload = function() {
                    document.getElementById('btn-cap-' + i).style.display = 'block';
                };
            }
        }

        function abrirCapitulo(num) {
            // Ocultamos todo lo demás
            document.getElementById('inicio').style.display = 'none';
            document.querySelector('.fondo-borroso').style.display = 'none';
            document.getElementById('visor-manga').style.display = 'block';
            
            const listaImg = document.getElementById('lista-imagenes');
            listaImg.innerHTML = ''; 

            // Cargar hasta 300 imágenes por capítulo
            for (let j = 1; j <= 300; j++) {
                const img = document.createElement('img');
                img.src = cap-${num}/${j}.jpg;
                img.loading = "lazy";
                img.onerror = function() { this.style.display = 'none'; };
                listaImg.appendChild(img);
            }

            // Configurar botones de navegación inferior
            document.getElementById('btn-ant').style.display = (num > 1) ? 'block' : 'none';
            document.getElementById('btn-ant').onclick = () => abrirCapitulo(num - 1);
            
            document.getElementById('btn-sig').innerText = 'SIGUIENTE CAPÍTULO ' + (num + 1);
            document.getElementById('btn-sig').onclick = () => abrirCapitulo(num + 1);

            window.scrollTo(0,0);
        }

        // Iniciar la búsqueda de capítulos al cargar la página
        detectarCapitulos();
    </script>
</body>
</html>
